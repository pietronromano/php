# Section 1: Introduction and Setup

References:
- https://www.udemy.com/course/codeigniter-from-scratch/learn/lecture/39182226#overview
- https://codeigniter.com/user_guide/installation/running.html#local-development-server

---

## Install CodeIgniter for our `ci-app` project using Composer
```bash
cd cogeigniter/deployment
composer create-project codeigniter4/appstarter ci-app
cd ci-app
``` 

---


## Deployment Folder
We use the same `deployment` folder for different versions of our project to be served by Apache: this is to avoid have to reconfigure Apache Virtual Hosts each time we switch versions of the project.
 
### macOS: 
- Create a `logs` and `writable` folders inside the `deployment` directory to store log files and output generated by Apache/CodeIgniter:
```bash
deployment_dir="/Users/macbookpro/dev/php/github/php/cogeigniter/deployment/"
mkdir $deployment_dir/ci-app
mkdir $deployment_dir/ci-app/public
mkdir $deployment_dir/logs
mkdir $deployment_dir/writable
mkdir $deployment_dir/writable/cache
mkdir $deployment_dir/writable/logs
``` 

#### Set Permissions for the `writable` directory
Avoid "*CodeIgniter\Cache\Exceptions\CacheException Cache unable to write to...*" errors by setting the correct permissions for the `writable` directory:
```bash
writable_dir=$deployment_dir/writable
sudo chmod -R 755 $writable_dir 
sudo chown -R _www:_www $writable_dir 
```

In the app/Config/Paths.php file, set the writable directory path to point to this new `writable` folder:
```php
public string $writableDirectory = '/Users/macbookpro/dev/php/github/php/cogeigniter/deployment/writable';
```

### Copy files to the deployment folder
**NOTE:**: on macOS use "Bash", not the default "Zsh" terminal shell, as `cp -R` behaves differently in Zsh (omits the hidden files lie `.env`).
- Set origin folder:
  ```bash
  origin_dir="/Users/macbookpro/dev/php/github/php/cogeigniter/04-db-display-insert/ci-app"
  ```

- Copy the contents of the `ci-app` folder to the `deployment/ci-app` folder:
  ```bash
  cp -R $origin_dir "/Users/macbookpro/dev/php/github/php/cogeigniter/deployment/"
  ```

---

## Configure the project with the .env file
- Rename `env` file to `.env`
    ```bash
    mv env .env
    ```
- Open the `.env` file
  - Set the environment to `development`
  - Set app.baseURL to match your Apache setup
    ```
    CI_ENVIRONMENT = development
    ...
    app.baseURL = 'http://ciapp.localhost:8080/'
    ```
- Save the file.

---

## Configure the Web Server
### Built-in PHP Server
- In the terminal, navigate to the `ci-app` directory if you're not already there:
- Start the built-in PHP server:
  ```bash
  php spark serve
  ```
  - Open your web browser and navigate to `http://localhost:8080` to see the CodeIgniter welcome page.

- Stop the server by pressing `CTRL + C` in the terminal when you're done.

- **Note:** If getting "Failed to listen on localhost:8080 (reason: Address already in use)", it means another process is using that port. You can either:
- Stop that process:
   - On MacOS/Linux, find the process ID (PID) using:
     ```bash
     lsof -i TCP:8080
     ```
   - Then kill the process using:
     ```bash
     kill -9 <PID>
     ``` 

- Or use a different port by specifying it when starting the server, e.g., `php spark serve --port 8081`.

**Conclusion**
On MacOS, I got a lot of problems with the built-in PHP server, so I recommend using Apache for local development also...
---

### Apache
SEE README-apache.md for Apache installation and configuration instructions.


